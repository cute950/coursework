# Проектная работа "Создание процесса непрерывной поставки для приложения с применением Практик CI/CD и быстрой обратной связью"
## Требования
- Настроен процесс сбора обратной связи
- Мониторинг (сбор метрик, алертинг, визуализация)
- Логирование (опционально)
- Трейсинг (опционально)
- ChatOps (опционально)
## Системные требования
Для успешного запуска проекта, в рабочем окружении должны быть установлены:
- python
- ansible
- terraform
- jinja

Для корректной работы terraform и yandex cloud можно указать зеркала, но я использовала vpn.

## Предварительные настройки
 Для запуска проекта необходимо:
  1. Cоздать и подготовить облако в Yandex.Cloud:
    - создать сервисный аккаунт
    - назначить необходимые роли для сервисного аккаунта
    - создать ключи авторизации и добавить их в проект в файл ``` ~/yandex-cloud/terraform-key.json ```
    - создать s3 bucket и настроить terraform backend

  2. Сгенерировать пару SSH ключей для проекта и задать путь к публичному ключу в проекте
    (terraform.tfvars - public_key_path)

  3. Задайте переменные
  - для terraform в infra/terraform/terraform.tvars
  - для S3 и Gitlab в файлах переменных окружения ansible
    ```infra/ansible/environments/prod/group_vars/all.yml```
    ```ansible/environments/prod/group_vars/all.yml```

## Описание работы:
Начинаем работу с выполнения команды bash create_infra.sh. Скрипт поднимает инфраструктуру всего приложения через ansible и terraform. Создаются 3 ВМ, отвечающие за:
 - тестирование (Gitlab-CI c Gitlab-runner)
 - мониторинг (Prometheus и Grafana)
 - интерфейс (Docker)
Отрыбатывает ansible playbook и создается инфраструктура разработки, включающая в себя:
  - Gitlab-CI + 1 активированный Gitlab-runner
  - Monitoring host (Prometheus, Grafana) - сбор метрик с node_exporter со обоих инстансов.
Процесс деплоя приложения проходит в гите. В файл ```ansible/environments/prod/inventory.tmpl``` нужно подставить публичный ipv4 у вм search_engine_app. После пуша в Gitlab-CI автоматически запускается pipeline, который прогоняет тесты для ui и crawler и, если они прошли успешно, запускает деплой в prod. Поднимается докер контейнер, который запускает ansible-playbook, который заходит на хост с интрфейсом и поднимает на нем приложение docker-compose файлом.
Для приятного визуала в ui приложения были добавлены css стили.

Ссылки на адреса приложения:
 ```
 App (ui) - http://<app_vm_ip>
 App (crawler) - http://<app_vm_ip>:8080
 Grafana - http://<monitoring_vm_ip>
 Prometheus - http://<monitoring_vm_ip>:9090
 ```

Удалить проект можно при помощи команды bash destroy_infra.sh

### Приложения
В директории ``` screencasts ``` находятся файлы видеозаписи экрана при выполнении скриптов. Файл infra - создание вм для тестирования, мониторинга и самого приложения, разворачивание инфраструктуры. Файл deploy - процесс ci/cd в гите и деплой приложения на прод.
